<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é€†å¤©æŒ‚æœºï¼šä¸€å‰‘é£å‡</title>

  <!-- èƒŒæ™¯éŸ³ä¹ -->
  <audio id="bgMusic" loop>
    <source src="https://cdn.jsdelivr.net/gh/mengzhuo/assets@main/xianxia-loop.mp3" type="audio/mpeg">
  </audio>

  <style>
    @font-face {
      font-family: 'ZiYun';
      src: url('https://cdn.jsdelivr.net/gh/lxgw/LxgwWenkaiWebFont@latest/fonts/LXGWWenKai-Regular.woff2') format('woff2');
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'ZiYun', 'Microsoft YaHei', sans-serif;
      background: url('https://cdn.jsdelivr.net/gh/mengzhuo/assets@main/xianxia-bg.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #e6e6e6;
      overflow-x: hidden;
      height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      display: flex;
      gap: 20px;
    }
    .main-panel {
      flex: 3;
    }
    .sidebar {
      flex: 2;
      background: rgba(10, 20, 50, 0.7);
      padding: 15px;
      border-radius: 12px;
      backdrop-filter: blur(8px);
      border: 1px solid #4a80d0;
      box-shadow: 0 0 20px rgba(100, 150, 255, 0.2);
    }

    h1 {
      text-align: center;
      color: #ff5c8d;
      text-shadow: 0 0 20px #ff5c8d, 0 0 40px #ff5c8d;
      font-size: 2.4em;
      letter-spacing: 3px;
      margin-bottom: 10px;
      animation: glow 2s infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 20px #ff5c8d; }
      to { text-shadow: 0 0 40px #ff5c8d, 0 0 60px #ff5c8d; }
    }

    .stats {
      background: rgba(0, 0, 0, 0.5);
      padding: 18px;
      border-radius: 12px;
      margin-bottom: 15px;
      line-height: 2;
      border-left: 6px solid #5ce6e6;
      box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.2);
    }
    .log {
      height: 300px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.4);
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      border: 1px solid #3a70b0;
      box-shadow: 0 0 10px rgba(0, 100, 255, 0.1);
    }
    .log div {
      margin-bottom: 6px;
      opacity: 0.9;
    }
    .inventory {
      margin-top: 15px;
    }
    .equipment-item {
      padding: 10px;
      margin-top: 6px;
      background: rgba(30, 40, 80, 0.6);
      border-radius: 8px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s ease;
      border-left: 4px solid transparent;
    }
    .equipment-item:hover {
      transform: translateX(8px);
      border-color: #5ce6e6;
      background: rgba(50, 80, 150, 0.6);
    }
    .btn {
      background: #ff5c8d;
      color: white;
      border: none;
      padding: 10px 14px;
      margin: 6px 2px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.2s;
    }
    .btn:hover { background: #ff8ca8; transform: scale(1.05); }
    .btn-big {
      background: #d4af37;
      padding: 14px;
      font-size: 16px;
      width: 100%;
      font-weight: bold;
      color: #000;
      text-shadow: 0 0 3px white;
    }
    .btn-start {
      background: linear-gradient(45deg, #d4af37, #ff8c00);
      font-size: 20px;
      padding: 20px;
      border: 2px solid #fff;
      box-shadow: 0 0 30px rgba(255, 140, 0, 0.6);
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* å“è´¨é¢œè‰² */
    .grade-0 { color: #aaa; }
    .grade-1 { color: white; }
    .grade-2 { color: #32cd32; }
    .grade-3 { color: #1e90ff; }
    .grade-4 { color: #9932cc; }
    .grade-5 { color: #ff8c00; }
    .grade-6 { color: #d4af37; text-shadow: 0 0 5px gold; }

    /* æˆå°± */
    .achievement {
      padding: 8px;
      margin: 5px 0;
      background: rgba(100, 50, 150, 0.3);
      border-radius: 6px;
      font-size: 13px;
      border-left: 3px solid #9932cc;
    }
    .achieved {
      background: rgba(50, 200, 100, 0.4);
      color: #a0ffa0;
      border-left-color: #32cd32;
      animation: popIn 0.5s;
    }
    @keyframes popIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* é›·åŠ«ç‰¹æ•ˆ */
    .trib-animation {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle, rgba(255,215,0,0.4), transparent 70%);
      pointer-events: none;
      z-index: 9999;
      display: none;
      animation: flash 0.4s infinite alternate;
    }
    .lightning {
      position: absolute;
      width: 100%;
      height: 100%;
      background: 
        linear-gradient(transparent, rgba(255,255,255,0.8), transparent),
        linear-gradient(45deg, transparent, rgba(255,215,0,0.6), transparent);
      opacity: 0;
      animation: strike 1s infinite;
    }
    @keyframes flash {
      from { opacity: 0.6; }
      to { opacity: 1; }
    }
    @keyframes strike {
      0%, 100% { opacity: 0; }
      40% { opacity: 1; }
      60% { opacity: 0.8; }
    }

    /* å¼•å¯¼é®ç½© */
    .guide-overlay {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      padding: 20px;
    }
    .guide-overlay h2 {
      color: #ff5c8d;
      margin: 20px 0;
      font-size: 2em;
    }
    .guide-overlay p {
      max-width: 600px;
      margin: 10px 0;
      line-height: 1.6;
      color: #ccc;
    }
  </style>
</head>
<body>

  <!-- é›·åŠ«ç‰¹æ•ˆ -->
  <div class="trib-animation" id="tribLight"></div>
  <div class="lightning" id="lightning"></div>

  <!-- å¯åŠ¨å¼•å¯¼é¡µ -->
  <div class="guide-overlay" id="guideOverlay">
    <h2>ğŸŒŒ é€†å¤©æŒ‚æœºï¼šä¸€å‰‘é£å‡</h2>
    <p>ä½ æœ¬æ˜¯å‡¡äººï¼Œå´åœ¨å¤æ´ä¸­å¾—ä¸€æ®‹å·â€”â€”ã€Šæ··æ²Œåå¤©è¯€ã€‹ã€‚</p>
    <p>ä»æ­¤è¸ä¸Šé€†å¤©ä¿®è¡Œä¹‹è·¯ï¼Œæ–©å¦–é™¤é­”ï¼Œç‚¼å™¨ç‚¼ä¸¹ï¼Œç»ˆå°†æ‰“ç ´æ¡æ¢ï¼Œé£å‡æˆä»™ï¼</p>
    <p>é•‡å‹ä¸‡æ—ï¼Œå”¯æˆ‘ç‹¬å°Šï¼</p>
    <button class="btn btn-start" onclick="startGame()">ğŸ”¥ ç‚¹æ­¤å¼€è„‰ï¼Œè¸å…¥ä¿®çœŸç•Œ</button>
  </div>

  <!-- ä¸»ç•Œé¢ -->
  <div id="mainUI" style="display:none;">
    <h1>ğŸŒŒ é€†å¤©æŒ‚æœºï¼šä¸€å‰‘é£å‡</h1>
    <div class="container">
      <div class="main-panel">
        <div class="stats" id="playerStats">åŠ è½½ä¸­...</div>
        <div class="log" id="combatLog"></div>
      </div>

      <div class="sidebar">
        <h3>ğŸ’ èƒŒåŒ… (<span id="invCount">0</span>/50)</h3>
        <div>
          <label><input type="checkbox" id="autoPickup" checked> è‡ªåŠ¨æ‹¾å–</label>
          <select id="minGradeForPickup">
            <option value="0">ä¸å±è”½</option>
            <option value="1">æ™®é€šåŠä»¥ä¸Š</option>
            <option value="2">ç²¾è‰¯åŠä»¥ä¸Š</option>
            <option value="3">ç¨€æœ‰åŠä»¥ä¸Š</option>
            <option value="4">å²è¯—åŠä»¥ä¸Š</option>
            <option value="5">ç¥è¯åŠä»¥ä¸Š</option>
          </select>
        </div>
        <button onclick="discardAll()" class="btn">ğŸ—‘ï¸ æ— æƒ…ä¸¢å¼ƒ</button>
        <button onclick="sellAll()" class="btn">ğŸ’° å‡ºå”®åƒåœ¾</button>

        <h3>ğŸ¯ å½“å‰å‰¯æœ¬</h3>
        <select id="dungeonSelect"></select>
        <div id="dungeonInfo"></div>

        <h3>âš”ï¸ è£…å¤‡æ </h3>
        <div id="equipslot"></div>

        <h3>ğŸ† æˆå°±</h3>
        <div id="achievements"></div>

        <h3>âš¡ æ¸¡åŠ«å°</h3>
        <button id="btnTrib" class="btn btn-big" onclick="attemptTribulation()" style="display:none;">
          ğŸ”¥ æ¸¡åŠ«çªç ´ï¼å¤©é›·æ»šæ»šè€Œæ¥ï¼
        </button>
      </div>
    </div>
  </div>

  <script>
    // ==================== å…¨å±€å˜é‡ ====================
    const REALMS = ["ç‚¼æ°”æœŸ", "ç­‘åŸºæœŸ", "é‡‘ä¸¹æœŸ", "å…ƒå©´æœŸ", "åŒ–ç¥æœŸ", "åˆä½“æœŸ", "å¤§ä¹˜æœŸ", "æ¸¡åŠ«æœŸ"];
    const DUNGEONS = [
      { name: "å‡¡äººæ´ç©´", monster: "é‡çŒªå¦–|æ¯’è›‡æ€ª|å°é¬¼", dropBase: 1, bossChance: 0.05 },
      { name: "å¹½å†¥å¤å¢“", monster: "éª·é«…å…µ|å¹½é­‚|çŸ³åƒé¬¼", dropBase: 3, bossChance: 0.1 },
      { name: "ä¹å¹½é­”åŸŸ", monster: "ç‚é­”|å½±åˆºå®¢|è¡€å‚€å„¡", dropBase: 6, bossChance: 0.15 },
      { name: "æ··æ²Œç¦åŒº", monster: "è™šç©ºå…½|å •ç¥æ®‹å¿µ|æ··æ²Œé­”", dropBase: 10, bossChance: 0.2 }
    ];
    const GRADES = ["ç ´æŸ", "æ™®é€š", "ç²¾è‰¯", "ç¨€æœ‰", "å²è¯—", "ç¥è¯", "ä¼ è¯´"];
    const GRADE_MULTIPLIERS = [0.5, 1.0, 1.8, 2.8, 4.0, 6.0, 10.0];
    const GRADE_EXTRA_ATTR_RANGE = [[0,1], [1,1], [2,2], [2,3], [3,4], [4,5], [5,6]];

    const EXTRA_ATTRS = [
      { n: "ç”Ÿå‘½å€¼", min: 10, max: 50 },
      { n: "æš´å‡»ç‡(%)", min: 1.0, max: 5.0, f: true },
      { n: "æ”»å‡»é€Ÿåº¦", min: 1, max: 5 },
      { n: "é—ªé¿ç‡(%)", min: 1.0, max: 5.0, f: true },
      { n: "å¸è¡€ç‡(%)", min: 0.5, max: 3.0, f: true },
      { n: "ç ´ç”²ç‡(%)", min: 1.0, max: 4.0, f: true },
      { n: "çœŸä¼¤åŠ æˆ", min: 5, max: 15 }
    ];

    const EQUIP_SLOTS = ["æ­¦å™¨", "æŠ¤ç”²", "å¤´å† ", "æŠ¤è…¿", "é¥°å“"];

    const ACHIEVEMENTS = [
      { id: "kill_10", cond: (p) => p.killCount >= 10, name: "åˆå…¥æ±Ÿæ¹–", desc: "å‡»æ€10ä¸ªæ€ªç‰©" },
      { id: "kill_100", cond: (p) => p.killCount >= 100, name: "æ€æˆ®æˆæ€§", desc: "å‡»æ€100ä¸ªæ€ªç‰©" },
      { id: "mythical", cond: (p) => p.stats.hasMythical, name: "ç¥è¯é™ä¸´", desc: "è·å¾—ä¸€ä»¶ç¥è¯è£…å¤‡" },
      { id: "legend", cond: (p) => p.stats.hasLegend, name: "ä¸‡å¤å”¯ä¸€", desc: "è·å¾—ä¼ è¯´æ³•å®" },
      { id: "realm_4", cond: (p) => p.realm >= 4, name: "åŒ–ç¥å°Šè€…", desc: "çªç ´è‡³åŒ–ç¥æœŸ" },
      { id: "gold_1000", cond: (p) => p.gold >= 1000, name: "å¯Œå¯æ•Œå›½", desc: "æ‹¥æœ‰1000çµçŸ³" }
    ];

    const player = {
      level: 1,
      realm: 0,
      attack: 10,
      defense: 5,
      health: 100,
      killCount: 0,
      dungeon: 0,
      inventory: [],
      equipment: {},
      skills: [],
      gold: 0,
      lastSave: Date.now(),
      achievements: {},
      stats: { hasMythical: false, hasLegend: false },
      inTribulation: false
    };

    for (let slot of EQUIP_SLOTS) player.equipment[slot] = null;
    for (let ach of ACHIEVEMENTS) player.achievements[ach.id] = false;

    // DOM Elements
    const bgMusic = document.getElementById("bgMusic");
    const tribLight = document.getElementById("tribLight");
    const lightning = document.getElementById("lightning");

    // ==================== å·¥å…·å‡½æ•° ====================
    function randInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function roll(prob) { return Math.random() < prob; }
    function log(text, cls = "") {
      const logDiv = document.getElementById("combatLog");
      const entry = document.createElement("div");
      if (cls) entry.className = cls;
      entry.textContent = `[${new Date().toTimeString().slice(0,5)}] ${text}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    // ==================== å¯åŠ¨æ¸¸æˆ ====================
    function startGame() {
      document.getElementById("guideOverlay").style.display = "none";
      document.getElementById("mainUI").style.display = "block";

      // æ’­æ”¾èƒŒæ™¯éŸ³ä¹ï¼ˆå¯èƒ½éœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
      bgMusic.play().catch(e => console.log("éŸ³ä¹éœ€æ‰‹åŠ¨æ’­æ”¾", e));

      loadGame();
      updateUI();
      fight();
      setInterval(fight, 3000);
      setInterval(saveGame, 60000);

      log("âœ¨ æ–°ç”Ÿé“å‹ï¼Œè¸ä¸Šé€†å¤©ä¹‹è·¯ï¼");
    }

    // ==================== æˆ˜æ–—ç³»ç»Ÿ ====================
    function fight() {
      if (player.inTribulation) return;
      const d = DUNGEONS[player.dungeon];
      const names = d.monster.split("|");
      let name = names[randInt(0, names.length - 1)];
      const isBoss = roll(d.bossChance);
      const isElite = roll(0.15);

      if (isBoss) name = `ã€å¤©åŠ«${name}Â·BOSSã€‘`;
      else if (isElite) name = `ã€æš—å½±${name}Â·ç²¾è‹±ã€‘`;

      log(`ğŸŒ€ é­é‡ ${name}ï¼`);
      setTimeout(() => {
        log(`âœ… é•‡å‹ ${name}ï¼`, "success");
        player.killCount++;

        window._isBoss = isBoss || isElite;
        if (roll(0.7)) {
          const equipment = createEquipment(player.dungeon);
          if (equipment.gradeIndex >= 5) player.stats.hasMythical = true;
          if (equipment.gradeIndex >= 6) player.stats.hasLegend = true;
          if (player.inventory.length < 50) {
            const minGrade = parseInt(document.getElementById("minGradeForPickup").value);
            const autoPick = document.getElementById("autoPickup").checked;
            if (!autoPick || equipment.gradeIndex >= minGrade) {
              player.inventory.push(equipment);
              log(`ğŸ è·å¾—æ³•å®ï¼šã€${equipment.grade}ã€‘${equipment.name}`, `grade-${equipment.gradeIndex}`);
            } else {
              log(`ğŸ—‘ï¸ è‡ªåŠ¨ä¸¢å¼ƒã€${equipment.grade}ã€‘${equipment.name}`);
            }
          }
        } else {
          player.gold += randInt(1, 5) * (player.dungeon + 1);
        }

        checkAchievements();
        checkRealmAdvance();
        updateUI();
      }, 600);
    }

    // ==================== è£…å¤‡ç”Ÿæˆ ====================
    function createEquipment(dungeonLevel) {
      let gradeIndex = dungeonLevel + randInt(-1, 2);
      gradeIndex = Math.max(0, Math.min(6, gradeIndex));
      if (window._isBoss) gradeIndex = Math.min(6, gradeIndex + 1);

      const multiplier = GRADE_MULTIPLIERS[gradeIndex] * (1 + dungeonLevel * 0.3);
      const type = EQUIP_SLOTS[randInt(0, 4)];
      const prefix = ["æ— å", "é’é”‹", "èµ¤ç„°", "ç„å†°", "é›·éœ†", "æ˜Ÿè¾°", "æ··æ²Œ"][randInt(0, 6)];

      const equip = {
        id: Date.now() + randInt(1, 1000),
        grade: GRADES[gradeIndex],
        gradeIndex: gradeIndex,
        type: type,
        name: `${prefix}Â·${type}`,
        baseAttributes: {},
        extraAttributes: {}
      };

      const baseAttack = Math.round(5 * multiplier);
      const baseDefense = Math.round(3 * multiplier);
      if (type === "æ­¦å™¨") equip.baseAttributes["æ”»å‡»åŠ›"] = baseAttack;
      else equip.baseAttributes["é˜²å¾¡åŠ›"] = baseDefense;

      const [minE, maxE] = GRADE_EXTRA_ATTR_RANGE[gradeIndex];
      const numExtra = randInt(minE, maxE);
      const attrsPool = [...EXTRA_ATTRS];
      for (let i = 0; i < numExtra && attrsPool.length > 0; i++) {
        const idx = randInt(0, attrsPool.length - 1);
        const attr = attrsPool.splice(idx, 1)[0];
        const value = attr.f ? (Math.random() * (attr.max - attr.min) + attr.min).toFixed(1) : randInt(attr.min, attr.max);
        equip.extraAttributes[attr.n] = value;
      }

      if (gradeIndex === 6) {
        const effects = ["å¯¹BOSSä¼¤å®³+15%", "å‡»æ€å›è¡€5%", "æ‰è½ç‡+20%", "ç»éªŒ+30%"];
        equip.effect = effects[randInt(0, effects.length - 1)];
      }

      return equip;
    }

    // ==================== æ¸¡åŠ«ç³»ç»Ÿ ====================
    function checkRealmAdvance() {
      const thresholds = [10, 30, 60, 100, 150, 210, 280];
      if (player.realm < thresholds.length && player.killCount >= thresholds[player.realm]) {
        player.inTribulation = true;
        log("âš¡ å¤©é“æ„Ÿåº”ï¼ä½ å·²è¾¾åˆ°ç“¶é¢ˆï¼Œå¯å°è¯•æ¸¡åŠ«çªç ´ï¼", "upgrade");
        document.getElementById("btnTrib").style.display = "block";
      }
    }

    function attemptTribulation() {
      const successRate = 0.7 + player.realm * 0.05;
      log(`ğŸ”¥ æ¸¡åŠ«å¼€å§‹ï¼æˆåŠŸç‡çº¦ ${(successRate*100).toFixed(0)}%...`);

      // é›·å…‰ç‰¹æ•ˆ
      tribLight.style.display = "block";
      lightning.style.opacity = 1;
      setTimeout(() => { lightning.style.opacity = 0; }, 1000);

      setTimeout(() => {
        if (roll(successRate)) {
          player.realm++;
          log(`ğŸ’¥ æˆåŠŸæ¸¡åŠ«ï¼è¿›å…¥ã€${REALMS[player.realm]}ã€‘ï¼`, "upgrade");
          document.getElementById("btnTrib").style.display = "none";
          player.inTribulation = false;
          applyEquipStats();
        } else {
          const loss = Math.floor(player.killCount * 0.1);
          player.killCount = Math.max(1, player.killCount - loss);
          log(`âŒ æ¸¡åŠ«å¤±è´¥ï¼ä¿®ä¸ºå—æŸï¼Œæ€æˆ®æ•°-${loss}`, "fail");
        }
        tribLight.style.display = "none";
        updateUI();
      }, 1500);
    }

    // ==================== è£…å¤‡ç³»ç»Ÿ ====================
    function equipItem(id) {
      const item = player.inventory.find(eq => eq.id === id);
      if (!item) return;
      const old = player.equipment[item.type];
      if (old) player.inventory.push(old);
      player.equipment[item.type] = item;
      player.inventory = player.inventory.filter(eq => eq.id !== id);
      applyEquipStats();
      log(`âš”ï¸ è£…å¤‡æ³•å®ï¼š${item.name}`);
      updateUI();
    }

    function unequip(slot) {
      const item = player.equipment[slot];
      if (item) {
        player.inventory.push(item);
        player.equipment[slot] = null;
        applyEquipStats();
        log(`ğŸ§¼ å¸ä¸‹æ³•å®ï¼š${item.name}`);
        updateUI();
      }
    }

    function applyEquipStats() {
      let atkBonus = 0, defBonus = 0;
      for (const slot in player.equipment) {
        const eq = player.equipment[slot];
        if (!eq) continue;
        if (eq.baseAttributes["æ”»å‡»åŠ›"]) atkBonus += eq.baseAttributes["æ”»å‡»åŠ›"];
        if (eq.baseAttributes["é˜²å¾¡åŠ›"]) defBonus += eq.baseAttributes["é˜²å¾¡åŠ›"];
      }
      player.attack = 10 + atkBonus + player.realm * 5;
      player.defense = 5 + defBonus + player.realm * 2;
    }

    // ==================== æˆå°±ç³»ç»Ÿ ====================
    function checkAchievements() {
      let newAch = 0;
      ACHIEVEMENTS.forEach(ach => {
        if (!player.achievements[ach.id] && ach.cond(player)) {
          player.achievements[ach.id] = true;
          log(`ğŸ† è§£é”æˆå°±ï¼šã€${ach.name}ã€‘â€”â€” ${ach.desc}`, "success");
          newAch++;
        }
      });
      if (newAch > 0) updateAchievements();
    }

    function updateAchievements() {
      const div = document.getElementById("achievements");
      div.innerHTML = "";
      ACHIEVEMENTS.forEach(ach => {
        const item = document.createElement("div");
        item.className = `achievement ${player.achievements[ach.id] ? 'achieved' : ''}`;
        item.textContent = `${ach.name}ï¼š${ach.desc}`;
        div.appendChild(item);
      });
    }

    // ==================== å­˜æ¡£ ====================
    function saveGame() {
      try {
        localStorage.setItem("immortal_idle_save", JSON.stringify(player));
      } catch (e) {}
    }

    function loadGame() {
      const save = localStorage.getItem("immortal_idle_save");
      if (save) {
        try {
          Object.assign(player, JSON.parse(save));
          log("ğŸ“œ æ£€æµ‹åˆ°å¾€ç”Ÿè®°å¿†...");
        } catch (e) {}
      }
    }

    // ==================== UI æ›´æ–° ====================
    function updateUI() {
      document.getElementById("playerStats").innerHTML = `
        <strong>é“å·</strong>: æ— åé“å‹<br/>
        <strong>å¢ƒç•Œ</strong>: ã€${REALMS[player.realm]}ã€‘${player.inTribulation ? ' âš ï¸å¾…æ¸¡åŠ«' : ''}<br/>
        <strong>æ”»å‡»åŠ›</strong>: ${player.attack} | <strong>é˜²å¾¡åŠ›</strong>: ${player.defense}<br/>
        <strong>çµçŸ³</strong>: ${player.gold} | <strong>æ€æˆ®æ•°</strong>: ${player.killCount}
      `;
      document.getElementById("invCount").textContent = player.inventory.length;

      const inv = document.getElementById("inventory");
      inv.innerHTML = "";
      player.inventory.slice(-8).reverse().forEach(eq => {
        const div = document.createElement("div");
        div.className = `equipment-item grade-${eq.gradeIndex}`;
        div.innerHTML = `${eq.name} <button style="float:right" onclick="equipItem(${eq.id})">è£…å¤‡</button>`;
        div.onclick = () => equipItem(eq.id);
        inv.appendChild(div);
      });

      const sel = document.getElementById("dungeonSelect");
      sel.innerHTML = "";
      DUNGEONS.forEach((d, i) => {
        const opt = document.createElement("option");
        opt.value = i;
        opt.text = d.name;
        if (i === player.dungeon) opt.selected = true;
        sel.appendChild(opt);
      });

      const d = DUNGEONS[player.dungeon];
      document.getElementById("dungeonInfo").innerHTML = `éš¾åº¦ï¼š${d.dropBase}å€ | BOSSæ¦‚ç‡ï¼š${(d.bossChance*100).toFixed(1)}%`;

      const es = document.getElementById("equipslot");
      es.innerHTML = "";
      for (const slot in player.equipment) {
        const eq = player.equipment[slot];
        const item = document.createElement("div");
        item.style.margin = "5px 0";
        if (eq) {
          item.innerHTML = `${slot}ï¼š${eq.name} <button onclick="unequip('${slot}')">å¸ä¸‹</button>`;
          item.className = `grade-${eq.gradeIndex}`;
        } else {
          item.innerHTML = `${slot}ï¼šç©º`;
          item.style.opacity = 0.5;
        }
        es.appendChild(item);
      }

      document.getElementById("btnTrib").style.display = player.inTribulation ? "block" : "none";
    }

    function discardAll() {
      const count = player.inventory.length;
      player.inventory = [];
      log(`ğŸ—‘ï¸ æ— æƒ…ä¸¢å¼ƒ ${count} ä»¶æ³•å®ï¼å¤§é“æ— æƒ…ï¼`);
      updateUI();
    }

    function sellAll() {
      const minSell = parseInt(prompt("å‡ºå”®ä½äºå“ªä¸ªå“è´¨ï¼Ÿ0=ç ´æŸ,1=æ™®é€š...", "1")) || 1;
      const filtered = player.inventory.filter(eq => eq.gradeIndex < minSell);
      const gold = filtered.reduce((sum, eq) => sum + (eq.gradeIndex + 1) * 10, 0);
      player.gold += gold;
      player.inventory = player.inventory.filter(eq => eq.gradeIndex >= minSell);
      log(`ğŸ’° å‡ºå”® ${filtered.length} ä»¶æ³•å®ï¼Œè·å¾—çµçŸ³ Ã—${gold}`);
      updateUI();
    }

    function changeDungeon() {
      player.dungeon = parseInt(document.getElementById("dungeonSelect").value);
      log(`ğŸšª åˆ‡æ¢å‰¯æœ¬ï¼š${DUNGEONS[player.dungeon].name}`);
    }
  </script>
</body>
</html>
